{
  "project_meta": {
    "name": "test-app",
    "version": "0.0.1",
    "description": "E2E Test App for StructCMS integration testing and reference implementation"
  },
  "context": {
    "dependencies": {
      "runtime": [
        "@structcms/core",
        "@structcms/api",
        "@structcms/admin",
        "next",
        "react",
        "react-dom",
        "@supabase/supabase-js"
      ],
      "dev": [
        "@playwright/test",
        "@tailwindcss/postcss",
        "@types/node",
        "@types/react",
        "@types/react-dom",
        "postcss",
        "tailwindcss",
        "typescript"
      ]
    },
    "environment_variables": {
      "SUPABASE_URL": "https://xxx.supabase.co",
      "SUPABASE_SECRET_KEY": "Service role key for server-side operations"
    },
    "file_structure": {
      "app/": "Next.js App Router pages and layouts",
      "app/admin/": "Admin pages with AdminProvider",
      "app/admin/pages/": "Page list and editor views",
      "app/admin/navigation/": "Navigation editor view",
      "app/admin/media/": "Media browser view",
      "app/[...slug]/": "Dynamic frontend page rendering",
      "app/api/cms/": "Route handlers wrapping @structcms/api",
      "app/api/cms/testing/": "Test-only reset and seed endpoints",
      "lib/": "Shared utilities (registry, adapters, seed data)",
      "lib/components/": "Frontend section components (hero, content, navigation)",
      "e2e/": "Playwright test specs"
    },
    "example_sections": {
      "hero": "title (string), subtitle (text), image (image)",
      "content": "body (richtext)"
    },
    "example_page_types": {
      "landing": "Allowed sections: hero, content",
      "blog": "Allowed sections: content"
    },
    "seed_data": {
      "pages": ["Home (landing)", "About Us (landing)", "Blog Post Example (blog)"],
      "navigations": ["main (with nested children)"]
    },
    "e2e_test_lifecycle": {
      "reset": "POST /api/cms/testing/reset — clears all pages, navigations, media",
      "seed": "POST /api/cms/testing/seed — inserts seed data",
      "pattern": "beforeEach: resetAndSeed() or resetOnly()"
    },
    "notes": [
      "This is NOT a publishable package — testing and reference only",
      "Uses real Supabase adapters — no mocks",
      "Route handlers are thin wrappers around @structcms/api handlers",
      "Admin pages are thin wrappers around @structcms/admin components",
      "CI uses GitHub Secrets for Supabase credentials"
    ]
  },
  "backlog": [
    {
      "group": "Setup",
      "feature": "Next.js Project Initialization",
      "description": "Create Next.js App Router project with TypeScript, configure workspace dependencies",
      "acceptance_criteria": [
        "package.json with workspace:* references to @structcms packages",
        "tsconfig.json extending base config",
        "next.config.ts with transpilePackages for workspace packages",
        "App runs with pnpm --filter test-app dev"
      ],
      "passes": true
    },
    {
      "group": "Setup",
      "feature": "Root Layout",
      "description": "Create root layout with html, body, and basic styling",
      "acceptance_criteria": [
        "app/layout.tsx with html and body tags",
        "Tailwind CSS configured (or minimal CSS)",
        "Children rendered in body"
      ],
      "passes": true
    },
    {
      "group": "Lib",
      "feature": "Supabase Adapters",
      "description": "Create lib/adapters.ts with real Supabase client and adapters",
      "acceptance_criteria": [
        "Supabase client created from env variables",
        "storageAdapter exported using createStorageAdapter",
        "mediaAdapter exported using createMediaAdapter",
        "Adapters work with existing Supabase test instance"
      ],
      "passes": true
    },
    {
      "group": "Lib",
      "feature": "Example Registry",
      "description": "Create lib/registry.ts with example sections and page types",
      "acceptance_criteria": [
        "HeroSection with title, subtitle, image fields",
        "ContentSection with body (richtext) field",
        "LandingPage type allowing hero, content sections",
        "BlogPage type allowing content section",
        "Registry exported for use in AdminProvider"
      ],
      "passes": true
    },
    {
      "group": "Lib",
      "feature": "Seed Data Definitions",
      "description": "Create lib/seed.ts with representative test data",
      "acceptance_criteria": [
        "seedPages array with 3 pages (Home, About, Blog Post)",
        "seedNavigations array with main navigation including children",
        "Data covers all section types and nested structures"
      ],
      "passes": true
    },
    {
      "group": "Lib",
      "feature": "Seed Runner",
      "description": "Create lib/seed-runner.ts with seed execution logic",
      "acceptance_criteria": [
        "runSeed() function creates pages and navigations via adapters",
        "Handles errors gracefully",
        "Can be called from API route or CLI"
      ],
      "passes": true
    },
    {
      "group": "Route Handlers",
      "feature": "Pages Route Handlers",
      "description": "Create route handlers for /api/cms/pages",
      "acceptance_criteria": [
        "GET /api/cms/pages returns page list via handleListPages",
        "POST /api/cms/pages creates page via handleCreatePage",
        "GET /api/cms/pages/[slug] returns single page",
        "PUT /api/cms/pages/[slug] updates page via handleUpdatePage",
        "DELETE /api/cms/pages/[slug] deletes page via handleDeletePage"
      ],
      "passes": true
    },
    {
      "group": "Route Handlers",
      "feature": "Navigation Route Handlers",
      "description": "Create route handlers for /api/cms/navigation",
      "acceptance_criteria": [
        "GET /api/cms/navigation/[name] returns navigation",
        "PUT /api/cms/navigation/[name] updates navigation"
      ],
      "passes": true
    },
    {
      "group": "Route Handlers",
      "feature": "Media Route Handlers",
      "description": "Create route handlers for /api/cms/media",
      "acceptance_criteria": [
        "GET /api/cms/media returns media list via handleListMedia",
        "POST /api/cms/media uploads file via handleUploadMedia",
        "DELETE /api/cms/media/[id] deletes media via handleDeleteMedia"
      ],
      "passes": true
    },
    {
      "group": "Route Handlers",
      "feature": "Test Reset Endpoint",
      "description": "Create POST /api/cms/testing/reset to clear all data",
      "acceptance_criteria": [
        "Deletes all pages via storageAdapter",
        "Deletes all navigations via storageAdapter",
        "Deletes all media via mediaAdapter",
        "Returns { status: 'reset' }"
      ],
      "passes": true
    },
    {
      "group": "Route Handlers",
      "feature": "Test Seed Endpoint",
      "description": "Create POST /api/cms/testing/seed to insert seed data",
      "acceptance_criteria": [
        "Calls runSeed() from seed-runner",
        "Returns { status: 'seeded' }",
        "Idempotent: can be called after reset"
      ],
      "passes": true
    },
    {
      "group": "Admin Pages",
      "feature": "Admin Layout",
      "description": "Create admin route group with AdminProvider and AdminLayout",
      "acceptance_criteria": [
        "app/admin/layout.tsx wraps children with AdminProvider",
        "Passes registry and apiBaseUrl to AdminProvider",
        "Uses AdminLayout with onNavigate for client-side routing",
        "Sidebar navigation works (Pages, Navigation, Media)"
      ],
      "passes": true
    },
    {
      "group": "Admin Pages",
      "feature": "Page List View",
      "description": "Create page list view at /pages",
      "acceptance_criteria": [
        "app/admin/pages/page.tsx renders PageList component",
        "onSelectPage navigates to /pages/[slug]",
        "onCreatePage navigates to /pages/new"
      ],
      "passes": true
    },
    {
      "group": "Admin Pages",
      "feature": "Create Page View",
      "description": "Create new page view at /pages/new",
      "acceptance_criteria": [
        "app/admin/pages/new/page.tsx renders PageEditor with empty data",
        "Page type selector available",
        "Save creates page and redirects to list"
      ],
      "passes": true
    },
    {
      "group": "Admin Pages",
      "feature": "Edit Page View",
      "description": "Create edit page view at /pages/[slug]",
      "acceptance_criteria": [
        "app/admin/pages/[slug]/page.tsx fetches page by slug",
        "Renders PageEditor with existing data",
        "Save updates page"
      ],
      "passes": true
    },
    {
      "group": "Admin Pages",
      "feature": "Navigation View",
      "description": "Create navigation editor view at /navigation",
      "acceptance_criteria": [
        "app/admin/navigation/page.tsx fetches main navigation",
        "Renders NavigationEditor component",
        "Save persists changes"
      ],
      "passes": true
    },
    {
      "group": "Admin Pages",
      "feature": "Media View",
      "description": "Create media browser view at /media",
      "acceptance_criteria": [
        "app/admin/media/page.tsx renders MediaBrowser component",
        "Upload, browse, delete functionality works"
      ],
      "passes": true
    },
    {
      "group": "E2E Tests",
      "feature": "Playwright Configuration",
      "description": "Configure Playwright for E2E testing",
      "acceptance_criteria": [
        "playwright.config.ts with baseURL localhost:3000",
        "webServer config to start Next.js dev server",
        "Test directory set to e2e/"
      ],
      "passes": true
    },
    {
      "group": "E2E Tests",
      "feature": "Test Helpers",
      "description": "Create e2e/helpers.ts with reset and seed utilities",
      "acceptance_criteria": [
        "resetAndSeed() calls reset then seed endpoints",
        "resetOnly() calls only reset endpoint",
        "BASE_URL configurable"
      ],
      "passes": true
    },
    {
      "group": "E2E Tests",
      "feature": "Create Page Test",
      "description": "E2E test for creating a new page",
      "acceptance_criteria": [
        "Navigate to /pages, click Create New Page",
        "Select page type, add section, fill fields",
        "Save and verify page appears in list",
        "Verify via API that page was created"
      ],
      "passes": true
    },
    {
      "group": "E2E Tests",
      "feature": "Edit Section Test",
      "description": "E2E test for editing an existing section",
      "acceptance_criteria": [
        "Seed a page with hero section",
        "Navigate to /pages/[slug], edit hero title",
        "Save and verify via API that data persisted"
      ],
      "passes": true
    },
    {
      "group": "E2E Tests",
      "feature": "Upload Media Test",
      "description": "E2E test for uploading and selecting media",
      "acceptance_criteria": [
        "Navigate to /media, upload test image",
        "Verify image appears in grid",
        "Navigate to page with image field",
        "Select uploaded image via ImagePicker",
        "Verify image preview shown"
      ],
      "passes": true
    },
    {
      "group": "E2E Tests",
      "feature": "Navigation Test",
      "description": "E2E test for editing navigation",
      "acceptance_criteria": [
        "Navigate to /navigation",
        "Add navigation item with label and href",
        "Add child item",
        "Save and verify via API"
      ],
      "passes": true
    },
    {
      "group": "E2E Tests",
      "feature": "Page List Test",
      "description": "E2E test for page list filtering and navigation",
      "acceptance_criteria": [
        "Seed 3 pages (2 landing, 1 blog)",
        "Verify all pages visible",
        "Test search filter",
        "Test page type filter",
        "Click row navigates to edit page"
      ],
      "passes": true
    },
    {
      "group": "Frontend",
      "feature": "Section Component Registry",
      "description": "Create lib/components/ with type-safe section component mapping using InferSectionData from @structcms/core",
      "acceptance_criteria": [
        "lib/components/index.ts exports sectionComponents map and isSectionType type guard",
        "Types inferred via InferSectionData — no manual type duplication",
        "SectionDataMap maps section names to their inferred data types",
        "Component registry is type-safe: each component receives correctly typed props"
      ],
      "passes": true
    },
    {
      "group": "Frontend",
      "feature": "Hero Section Component",
      "description": "Create lib/components/hero.tsx rendering hero section data",
      "acceptance_criteria": [
        "Renders title as h1",
        "Renders optional subtitle as paragraph",
        "Renders optional image",
        "Props typed via HeroData from component registry"
      ],
      "passes": true
    },
    {
      "group": "Frontend",
      "feature": "Content Section Component",
      "description": "Create lib/components/content.tsx rendering richtext content. HTML is safe because @structcms/api sanitizes on write.",
      "acceptance_criteria": [
        "Renders body HTML via dangerouslySetInnerHTML",
        "Props typed via ContentData from component registry",
        "Wrapped in prose class for typography"
      ],
      "passes": true
    },
    {
      "group": "Frontend",
      "feature": "Dynamic Page Rendering",
      "description": "Create app/[slug]/page.tsx that fetches a page by slug and renders its sections using the component registry",
      "acceptance_criteria": [
        "Server component fetching page data via storageAdapter",
        "Renders sections dynamically using sectionComponents map",
        "Unknown section types logged with console.warn and skipped",
        "Returns notFound() for non-existent slugs",
        "Next.js 15 params handled as Promise"
      ],
      "passes": true
    },
    {
      "group": "Frontend",
      "feature": "Navigation Component",
      "description": "Create lib/components/navigation.tsx rendering navigation with nested dropdown support",
      "acceptance_criteria": [
        "Renders top-level navigation items as links",
        "Renders children as dropdown on hover",
        "Uses NavigationItem type from @structcms/core",
        "Uses Next.js Link component"
      ],
      "passes": true
    },
    {
      "group": "Frontend",
      "feature": "Frontend Layout Integration",
      "description": "Integrate Navigation component into the root layout and connect the homepage to CMS content. This makes the frontend rendering visible as a cohesive app in the browser.",
      "acceptance_criteria": [
        "app/layout.tsx loads navigation data via handleGetNavigation and renders Navigation component",
        "Homepage (app/page.tsx) renders the CMS page with slug 'home' or shows a fallback",
        "Navigation links work and route to [slug] pages",
        "Browser verified: navigation visible, pages reachable via nav links"
      ],
      "passes": true
    },
    {
      "group": "Cleanup",
      "feature": "Fix NavigationItem Import",
      "description": "Change NavigationItem import in admin navigation page from @structcms/api to @structcms/core",
      "acceptance_criteria": [
        "app/admin/navigation/page.tsx imports NavigationItem from @structcms/core",
        "TypeScript typecheck passes"
      ],
      "passes": true
    },
    {
      "group": "Cleanup",
      "feature": "Tailwind v4 Config Cleanup",
      "description": "Remove dead Tailwind v3 config file and unused autoprefixer dependency",
      "acceptance_criteria": [
        "tailwind.config.ts deleted (unused by Tailwind v4)",
        "autoprefixer removed from devDependencies",
        "Styles still render correctly"
      ],
      "passes": true
    },
    {
      "group": "Admin",
      "feature": "Dashboard Route Integration",
      "description": "Add dashboard route as the default admin entry point with proper navigation callbacks",
      "acceptance_criteria": [
        "app/admin/page.tsx created with DashboardPage component",
        "DashboardPage imported from @structcms/admin",
        "Navigation callbacks implemented: onNavigate, onSelectPage, onCreatePage, onUploadMedia",
        "onNavigate routes to /admin/pages, /admin/navigation, /admin/media",
        "onSelectPage routes to /admin/pages/[id]",
        "onCreatePage routes to /admin/pages/new",
        "onUploadMedia routes to /admin/media",
        "TypeScript typecheck passes"
      ],
      "passes": true
    },
    {
      "group": "Admin",
      "feature": "Dashboard Navigation Update",
      "description": "Update admin layout navigation to include dashboard as the first item",
      "acceptance_criteria": [
        "app/admin/layout.tsx navItems array updated",
        "Dashboard added as first nav item with path '/admin'",
        "Existing nav items (Pages, Navigation, Media) remain in order",
        "Dashboard highlighted as active when on /admin route",
        "Navigation test passes for dashboard route"
      ],
      "passes": true
    },
    {
      "group": "E2E",
      "feature": "Dashboard E2E Tests",
      "description": "Add end-to-end tests for dashboard functionality including KPI cards, recent pages, and quick actions",
      "acceptance_criteria": [
        "e2e/dashboard.spec.ts created with dashboard test suite",
        "Test visits /admin and verifies dashboard loads",
        "Test verifies KPI cards display (pages, media, navigation, sections counts)",
        "Test verifies recent pages list shows max 10 items sorted by updatedAt",
        "Test verifies quick actions buttons are present and clickable",
        "Test quick actions navigate to correct pages (/admin/pages/new, /admin/media)",
        "Test recent page click navigates to page editor",
        "Test error handling: API failures show error states with retry buttons",
        "Test loading states: skeleton loaders appear during data fetching",
        "All tests pass with pnpm test:e2e"
      ],
      "passes": true
    },
    {
      "group": "Documentation",
      "feature": "Setup Guide in Root README",
      "description": "Add a Setup Guide section to the root README.md with step-by-step instructions and code examples for integrating StructCMS into a host project",
      "acceptance_criteria": [
        "New '## Setup Guide' section in root README.md",
        "Step 1: Install packages (pnpm add @structcms/core @structcms/api @structcms/admin)",
        "Step 2: Configure Supabase environment variables",
        "Step 3: Run database migrations (link to @structcms/api README)",
        "Step 4: Create lib/registry.ts with example section definitions",
        "Step 5: Create lib/adapters.ts with Supabase client and adapters",
        "Step 6: Create route handlers in app/api/cms/ with code example",
        "Step 7: Create admin layout with AdminProvider and AdminLayout",
        "Step 8: Create admin pages (pages, navigation, media)",
        "Code examples for each step (TypeScript)",
        "Link to examples/test-app as full reference implementation"
      ],
      "passes": false
    },
    {
      "group": "E2E Fixes",
      "feature": "Fix Navigation Test Selectors (P0)",
      "description": "Fix critical selector bug in navigation.spec.ts where text selectors don't match input values",
      "acceptance_criteria": [
        "e2e/navigation.spec.ts lines 14-16 updated to use data-testid selectors",
        "Replace text=Home with [data-testid=\"nav-item-label-0\"] and toHaveValue('Home')",
        "Replace text=About with [data-testid=\"nav-item-label-1\"] and toHaveValue('About')",
        "Replace text=Blog with [data-testid=\"nav-item-label-2\"] and toHaveValue('Blog')",
        "Test passes with pnpm test:e2e"
      ],
      "passes": true
    },
    {
      "group": "E2E Fixes",
      "feature": "Fix Edit Section Test Selectors (P1)",
      "description": "Fix fragile selectors in edit-section.spec.ts for better reliability",
      "acceptance_criteria": [
        "e2e/edit-section.spec.ts line 12: Update title input selector to be section-specific",
        "Change to page.locator('[data-testid=\"section-editor\"] input[name=\"title\"]').first()",
        "e2e/edit-section.spec.ts line 17: Replace text selector with data-testid",
        "Change 'text=Save Page' to '[data-testid=\"save-page\"]'",
        "e2e/edit-section.spec.ts line 18: Replace text selector with data-testid",
        "Change 'text=Save Navigation' to '[data-testid=\"nav-save\"]'",
        "All tests pass with pnpm test:e2e"
      ],
      "passes": true
    },
    {
      "group": "E2E Coverage",
      "feature": "PageList Filter Tests",
      "description": "Add E2E tests for PageList filtering functionality including page type filter, error states, and empty states",
      "acceptance_criteria": [
        "e2e/page-list.spec.ts extended with new test cases",
        "Test page type filter: select 'landing' shows only landing pages",
        "Test error state: simulate API failure and verify error message display",
        "Test empty state: resetOnly() then verify 'No pages yet' message",
        "All assertions use proper data-testid selectors",
        "New tests pass with pnpm test:e2e"
      ],
      "passes": false
    },
    {
      "group": "E2E Coverage",
      "feature": "PageEditor Section Management Tests",
      "description": "Add E2E tests for section management in PageEditor including add, remove, move, and type selection",
      "acceptance_criteria": [
        "e2e/section-management.spec.ts created with comprehensive section tests",
        "Test add section: select content type, click add, verify new section editor appears",
        "Test remove section: click remove button, verify section count decreases",
        "Test move section: click up/down buttons, verify order changes in API",
        "Test section type selection: different types show appropriate form fields",
        "All tests use proper data-testid selectors and verify API state",
        "Tests pass with pnpm test:e2e"
      ],
      "passes": false
    },
    {
      "group": "E2E Coverage",
      "feature": "NavigationEditor Item Management Tests",
      "description": "Add E2E tests for NavigationEditor item management including add, remove, edit, and nested items",
      "acceptance_criteria": [
        "e2e/navigation-management.spec.ts created with navigation item tests",
        "Test add navigation item: click add, fill label/href, save, verify API count increases",
        "Test remove navigation item: click remove, save, verify API count decreases",
        "Test add child item: click add child, verify nested structure",
        "Test edit item: change label/href values, save, verify API persistence",
        "All tests use data-testid selectors and verify navigation API response",
        "Tests pass with pnpm test:e2e"
      ],
      "passes": false
    },
    {
      "group": "E2E Coverage",
      "feature": "MediaBrowser Grid and Delete Tests",
      "description": "Add E2E tests for MediaBrowser grid display, delete functionality, and media selection",
      "acceptance_criteria": [
        "e2e/media-management.spec.ts created with comprehensive media tests",
        "Test grid display: upload image, verify thumbnail appears in grid",
        "Test delete media: click delete button, verify media disappears from grid and API",
        "Test media selection: open media browser, select item, verify callback behavior",
        "Test pagination: upload >20 items, verify load more button works",
        "All tests use proper data-testid selectors and verify media API state",
        "Tests pass with pnpm test:e2e"
      ],
      "passes": false
    },
    {
      "group": "E2E Coverage",
      "feature": "AdminLayout Navigation Tests",
      "description": "Add E2E tests for AdminLayout sidebar navigation between admin pages and active link highlighting",
      "acceptance_criteria": [
        "e2e/admin-navigation.spec.ts created with sidebar navigation tests",
        "Test sidebar navigation: click Pages, Navigation, Media, Dashboard links",
        "Verify each click navigates to correct URL (/admin/pages, /admin/navigation, etc.)",
        "Test active link highlighting: verify aria-current=\"page\" on active nav item",
        "Test navigation flow: navigate through multiple admin pages in sequence",
        "All tests use data-testid selectors where available",
        "Tests pass with pnpm test:e2e"
      ],
      "passes": false
    }
  ]
}
