{
  "project_meta": {
    "name": "@structcms/admin",
    "version": "0.1.0",
    "description": "Admin UI components for StructCMS"
  },
  "context": {
    "dependencies": {
      "runtime": [
        "@structcms/core",
        "@structcms/api",
        "react",
        "react-dom",
        "react-hook-form",
        "@hookform/resolvers",
        "@tiptap/react",
        "@tiptap/starter-kit",
        "@tiptap/extension-link",
        "tailwindcss",
        "class-variance-authority",
        "clsx",
        "tailwind-merge",
        "lucide-react"
      ],
      "dev": ["vitest", "@testing-library/react", "playwright", "typescript"],
      "shadcn_components": ["button", "input", "textarea", "card", "dialog", "select", "label", "separator", "toast", "skeleton"]
    },
    "package_exports": [
      "PageEditor",
      "SectionEditor",
      "MediaBrowser",
      "NavigationEditor",
      "PageList",
      "AdminLayout",
      "FormGenerator",
      "StringInput",
      "TextInput",
      "RichTextEditor",
      "ImagePicker",
      "ArrayField",
      "ObjectField"
    ],
    "api_configuration": {
      "base_url": "Configurable via AdminProvider context, default: /api/cms",
      "example": "<AdminProvider apiBaseUrl='/api/cms' registry={registry}><AdminLayout /></AdminProvider>"
    },
    "file_structure": {
      "src/": "Source files",
      "src/components/": "React components",
      "src/components/inputs/": "Field input components (StringInput, TextInput, etc.)",
      "src/components/editors/": "Editor components (SectionEditor, PageEditor)",
      "src/components/layout/": "Layout components (AdminLayout, Sidebar)",
      "src/components/media/": "Media components (MediaBrowser, ImagePicker)",
      "src/lib/": "Utilities (cn, form-generator)",
      "src/context/": "React contexts (AdminProvider)",
      "src/hooks/": "Custom hooks (usePages, useMedia)",
      "src/index.ts": "Package entry point"
    },
    "integration_in_host": {
      "next_js_app_router": "Host creates admin route group (e.g., app/(admin)/)",
      "example_page": "import { PageEditor } from '@structcms/admin'; export default function EditPage({ params }) { return <PageEditor slug={params.slug} />; }",
      "provider_setup": "Wrap admin routes with AdminProvider passing registry and API base URL"
    },
    "ui_decisions": {
      "richtext_editor": "TipTap with StarterKit + Link extension",
      "section_reordering": "Up/Down buttons (no drag & drop)",
      "array_reordering": "Up/Down buttons (no drag & drop)",
      "save_behavior": "Manual save only (no autosave)",
      "styling": "Tailwind CSS + shadcn/ui components"
    },
    "notes": [
      "All components receive registry from AdminProvider context",
      "Form generation uses React Hook Form + Zod resolver",
      "Components are headless-friendly but styled by default",
      "API calls use fetch() to configured base URL",
      "No drag & drop - explicit out of scope",
      "@structcms/api provides response types (PageResponse, MediaResponse, etc.)"
    ]
  },
  "backlog": [
    {
      "group": "Context",
      "feature": "AdminProvider Context",
      "description": "React context provider for registry, API base URL, and shared state",
      "acceptance_criteria": [
        "Provides registry to all child components",
        "Configurable apiBaseUrl prop",
        "Exposes useAdmin() hook for context access",
        "Provides useApiClient() hook for API calls",
        "Unit test: context values accessible in child components"
      ],
      "passes": true
    },
    {
      "group": "Field Inputs",
      "feature": "String Input Component",
      "description": "Text input component for string fields with label, placeholder, validation error display",
      "acceptance_criteria": [
        "Renders shadcn/ui Input component",
        "Displays label and optional placeholder",
        "Shows validation errors below input",
        "Supports required/optional indicator",
        "Unit test: renders and validates correctly"
      ],
      "passes": true
    },
    {
      "group": "Field Inputs",
      "feature": "Text Input Component",
      "description": "Textarea component for long text fields",
      "acceptance_criteria": [
        "Renders shadcn/ui Textarea component",
        "Supports configurable rows",
        "Displays label and validation errors",
        "Unit test: renders correctly"
      ],
      "passes": true
    },
    {
      "group": "Field Inputs",
      "feature": "RichText Editor Component",
      "description": "WYSIWYG editor for richtext fields using TipTap",
      "acceptance_criteria": [
        "Integrates TipTap editor",
        "Supports bold, italic, links, lists, headings",
        "Outputs HTML string",
        "Styled to match shadcn/ui design",
        "Unit test: editor renders and outputs HTML"
      ],
      "passes": true
    },
    {
      "group": "Field Inputs",
      "feature": "Image Picker Component",
      "description": "Component for image fields that opens MediaBrowser for selection",
      "acceptance_criteria": [
        "Shows current image preview if selected",
        "Button to open MediaBrowser modal",
        "Stores media ID or URL in form",
        "Clear button to remove selection",
        "Unit test: selection flow"
      ],
      "passes": true
    },
    {
      "group": "Field Inputs",
      "feature": "Array Field Component",
      "description": "Component for array fields with add/remove/reorder (buttons) functionality",
      "acceptance_criteria": [
        "Add button appends new item",
        "Remove button on each item",
        "Up/Down buttons for reordering",
        "Renders nested form for each item",
        "Unit test: add, remove, reorder operations"
      ],
      "passes": true
    },
    {
      "group": "Field Inputs",
      "feature": "Object Field Component",
      "description": "Component for nested object fields, rendering sub-form",
      "acceptance_criteria": [
        "Renders nested form fields for object properties",
        "Visually grouped (card or indentation)",
        "Supports nested validation",
        "Unit test: nested form renders"
      ],
      "passes": true
    },
    {
      "group": "Form Generation",
      "feature": "Form Generator from Zod Schema",
      "description": "Create component that generates React Hook Form from Zod schema, mapping field types to appropriate input components",
      "acceptance_criteria": [
        "Accepts Zod schema and generates form fields",
        "Integrates with React Hook Form + Zod resolver",
        "Maps each field type to corresponding input component",
        "Handles validation errors from Zod",
        "Unit test: form generation from sample schema"
      ],
      "passes": true
    },
    {
      "group": "Editors",
      "feature": "Section Editor Component",
      "description": "Component that renders form for a section based on its schema from registry",
      "acceptance_criteria": [
        "Accepts section type and data",
        "Looks up schema from registry",
        "Generates form using Form Generator",
        "Emits onChange with updated section data",
        "Unit test: renders form for section type"
      ],
      "passes": true
    },
    {
      "group": "Editors",
      "feature": "Page Editor Component",
      "description": "Full page editor with multiple sections, add/remove/reorder sections using buttons",
      "acceptance_criteria": [
        "Displays list of sections with SectionEditor for each",
        "Add Section button with section type selector",
        "Remove button on each section",
        "Up/Down buttons for section reordering",
        "Save button triggers onSave callback",
        "Unit test: section management operations"
      ],
      "passes": true
    },
    {
      "group": "Content Management",
      "feature": "Page List Component",
      "description": "List all pages with filter/search, link to edit each page",
      "acceptance_criteria": [
        "Fetches and displays pages from API",
        "Search input filters by title/slug",
        "Filter by page type",
        "Click row navigates to PageEditor",
        "Create New Page button",
        "Unit test: list renders and filters"
      ],
      "passes": true
    },
    {
      "group": "Content Management",
      "feature": "Navigation Editor Component",
      "description": "Editor for navigation items with nested structure support",
      "acceptance_criteria": [
        "Displays navigation items as list",
        "Edit label and href for each item",
        "Add/remove items",
        "Support nested children (one level)",
        "Save button persists changes",
        "Unit test: navigation editing"
      ],
      "passes": true
    },
    {
      "group": "Media",
      "feature": "Media Browser Component",
      "description": "Browse, upload, and select media files",
      "acceptance_criteria": [
        "Grid display of uploaded media",
        "Upload button with file input",
        "Click to select (for Image Picker integration)",
        "Delete button on each media item",
        "Pagination or infinite scroll",
        "Unit test: browse and select flow"
      ],
      "passes": true
    },
    {
      "group": "Layout",
      "feature": "Admin Layout Shell",
      "description": "Admin layout with sidebar navigation, header, and content area",
      "acceptance_criteria": [
        "Sidebar with links: Pages, Navigation, Media",
        "Header with app title",
        "Responsive: sidebar collapses on mobile",
        "Uses shadcn/ui components and Tailwind",
        "Unit test: layout renders correctly"
      ],
      "passes": true
    },
    {
      "group": "UX",
      "feature": "Loading and Error States",
      "description": "Reusable components for loading indicators and error handling with toast notifications",
      "acceptance_criteria": [
        "Skeleton components for content loading",
        "Toast notifications for success/error feedback",
        "Error boundary for component-level errors",
        "useToast() hook for triggering notifications",
        "Unit test: loading and error states render correctly"
      ],
      "passes": true
    },
    {
      "group": "Bugfix",
      "feature": "Fix MediaBrowser Upload URL",
      "description": "Upload URL is broken: ternary always evaluates to empty string, hitting /media instead of ${apiBaseUrl}/media",
      "acceptance_criteria": [
        "Upload uses apiBaseUrl from context or useApiClient upload() method",
        "Upload sends FormData to correct endpoint",
        "Unit test: upload triggers correct API call",
        "Existing MediaBrowser tests still pass"
      ],
      "passes": true
    },
    {
      "group": "Bugfix",
      "feature": "Add Array and Object Cases to FormGenerator",
      "description": "FormGenerator switch statement missing array/object cases, silently renders StringInput instead of ArrayField/ObjectField",
      "acceptance_criteria": [
        "FormGenerator renders ArrayField for array field types",
        "FormGenerator renders ObjectField for object field types",
        "Unit test: array and object fields render correct components",
        "Existing FormGenerator tests still pass"
      ],
      "passes": false
    },
    {
      "group": "Refactor",
      "feature": "Memoize useApiClient",
      "description": "createApiClient is called every render without memoization, causing useCallback dependencies to be ineffective",
      "acceptance_criteria": [
        "createApiClient wrapped in useMemo keyed on apiBaseUrl",
        "Remove eslint-disable comments in PageList and MediaBrowser",
        "Existing tests still pass",
        "Typecheck passes"
      ],
      "passes": false
    },
    {
      "group": "Refactor",
      "feature": "Consolidate NavItem Types",
      "description": "Three conflicting NavItem types: navigation-editor, admin-layout, and unused NavigationItem from core",
      "acceptance_criteria": [
        "NavigationEditor uses NavigationItem from @structcms/core",
        "AdminLayout NavItem renamed to SidebarNavItem",
        "No duplicate NavItem exports",
        "Existing tests still pass"
      ],
      "passes": false
    },
    {
      "group": "Refactor",
      "feature": "Integrate Toast into AdminProvider",
      "description": "ToastProvider is separate, no component uses toast for feedback. Consumer must manually nest providers",
      "acceptance_criteria": [
        "AdminProvider wraps ToastProvider internally",
        "useToast() works inside AdminProvider without extra nesting",
        "Existing tests still pass"
      ],
      "passes": false
    },
    {
      "group": "Refactor",
      "feature": "SectionEditor Auto-Sync in PageEditor",
      "description": "Each SectionEditor has its own submit button, unsubmitted changes are silently lost when Save Page is clicked",
      "acceptance_criteria": [
        "Section data syncs to PageEditor on field change (onChange/onBlur)",
        "Save Page captures all current section data without per-section submit",
        "Existing PageEditor tests updated accordingly",
        "Unit test: unsaved section data is included in Save Page"
      ],
      "passes": false
    },
    {
      "group": "Refactor",
      "feature": "ErrorBoundary Reset Mechanism",
      "description": "ErrorBoundary has no reset mechanism, user must reload the page after an error",
      "acceptance_criteria": [
        "Default error UI includes a Retry button",
        "Retry resets error state and re-renders children",
        "Optional onReset callback prop",
        "Unit test: reset clears error state",
        "Existing ErrorBoundary tests still pass"
      ],
      "passes": false
    },
    {
      "group": "Refactor",
      "feature": "Fix Toast Counter Module-Level State",
      "description": "Toast counter is module-level variable, shared across all ToastProvider instances and SSR renders",
      "acceptance_criteria": [
        "Toast ID generation uses useRef inside ToastProvider",
        "Multiple ToastProvider instances have independent counters",
        "Existing Toast tests still pass"
      ],
      "passes": false
    },
    {
      "group": "Testing",
      "feature": "E2E Tests for Critical Flows",
      "description": "End-to-end tests for critical admin flows: create page, edit section, upload media",
      "acceptance_criteria": [
        "E2E test: create new page with sections",
        "E2E test: edit existing page section",
        "E2E test: upload media and select in content",
        "Tests run with Playwright or Cypress",
        "Tests documented in README"
      ],
      "passes": false
    }
  ]
}
